\documentclass[12pt,a4paper,oneside]{book}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{textcomp}
\usepackage{lmodern} % gunakan font scalable agar microtype expansion aman

% Definisi karakter Unicode yang tidak didukung
\DeclareUnicodeCharacter{2260}{\neq}
\usepackage[english,indonesian]{babel}
\usepackage{geometry}
\geometry{margin=2.5cm}
\setlength{\headheight}{14.49998pt} % Perbaiki warning fancyhdr
\addtolength{\topmargin}{-2.49998pt} % Sesuaikan top margin
\usepackage{amsmath,amssymb,amsthm}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{booktabs,longtable,ltxtable}
\usepackage{supertabular}
\usepackage{calc}
\usepackage{hyperref}
\usepackage{subfiles}
\usepackage{csquotes}
% Suppress csquotes warning untuk bahasa Indonesia
\DeclareQuoteStyle{indonesian}
  {\guillemotleft}{\guillemotright}
  {\textquotedblleft}{\textquotedblright}
\usepackage{microtype}

% Microtype configuration untuk perbaikan tipografi
\microtypesetup{
    protrusion=true,
    expansion=true,
    tracking=true,
    kerning=true,
    spacing=true,
    factor=1100,
    stretch=20,
    shrink=20,
    step=1,
    final=true,
    verbose=false
}

% Fix microtype spacing warning - removed problematic context setting

% Fix microtype warnings for missing characters
\DeclareMicrotypeAlias{T1/lmr/m/sc}{T1/lmr/m/n}
\usepackage[style=ieee,sorting=none,backend=biber,language=english]{biblatex}
\addbibresource{references.bib}

% Explicitly set bibliography language to English
\DeclareLanguageMapping{indonesian}{english}

\usepackage{xcolor}
\usepackage{listings}
\usepackage{array}
\usepackage{caption}
\usepackage{float} % Package untuk kontrol posisi tabel dan gambar
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{tocloft}
\usepackage{etoolbox} % Untuk patching environment

\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue,
    urlcolor=blue,
    bookmarksnumbered=true,
    bookmarksopen=true,
    pdfstartview=FitH,
    pdfpagelayout=SinglePage,
    unicode=true,
    breaklinks=true,
    pdfduplex=Simplex,
    pdfprintscaling=None
}
\setlist{nosep}

% Penomoran lingkungan matematis per-bab
\numberwithin{equation}{chapter}
\theoremstyle{definition}
\newtheorem{definition}{Definisi}[chapter]
\newtheorem{example}{Contoh}[chapter]
\theoremstyle{plain}
\newtheorem{theorem}{Teorema}[chapter]
\newtheorem{lemma}{Lema}[chapter]

% Setup code listing
\lstset{
    basicstyle=\ttfamily\footnotesize,
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    tabsize=2,
    language=[x86masm]Assembler,
    breakatwhitespace=true,
    breakautoindent=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}

% Membuat font dalam tabel lebih kecil secara otomatis
\AtBeginEnvironment{tabular}{\small}
\AtBeginEnvironment{longtable}{\small}
\AtBeginEnvironment{supertabular}{\small}

% Konfigurasi untuk tabel yang dapat dibagi halaman
\setlength{\LTcapwidth}{\textwidth}

% Center longtable secara otomatis menggunakan LTleft dan LTright
% Ini adalah cara yang benar untuk center longtable berdasarkan sumber terbuka
\setlength{\LTleft}{0pt plus 1fill}
\setlength{\LTright}{0pt plus 1fill}

% Create a centered longtable environment yang menggunakan pendekatan yang benar
\newenvironment{centeredlongtable}[1]{%
  \begin{longtable}{#1}%
}{%
  \end{longtable}%
}

% Konfigurasi untuk longtable
\renewcommand{\arraystretch}{1.1}
\setlength{\LTpre}{0pt}
\setlength{\LTpost}{0pt}

% Konfigurasi untuk supertabular
\setlength{\extrarowheight}{2pt}

% Helper commands untuk tabel yang dapat dibagi halaman
\newcommand{\longtablecaption}[2]{%
  \caption{#1}%
  \label{#2}%
}

% Konfigurasi untuk mencegah halaman kosong
\raggedbottom
\widowpenalty=10000
\clubpenalty=10000

% Konfigurasi untuk tabel yang lebih fleksibel
\renewcommand{\floatpagefraction}{0.7}
\renewcommand{\textfraction}{0.1}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}

% Perbaiki masalah tabel yang terlalu lebar
\setlength{\tabcolsep}{1.5pt}
\renewcommand{\arraystretch}{0.95}
% Additional table improvements
\setlength{\extrarowheight}{1pt}

% Fix table width issues
\setlength{\LTcapwidth}{\textwidth}

% Better table column width handling
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}

% Perbaiki masalah underfull hbox dan hyphenation
\hyphenpenalty=50
\exhyphenpenalty=50
\tolerance=3000
\emergencystretch=5em
\pretolerance=1000
\doublehyphendemerits=10000
\finalhyphendemerits=5000
\adjdemerits=10000
% Additional hyphenation improvements
\sloppy
\raggedbottom
\widowpenalty=10000
\clubpenalty=10000

% Fix bad boxes and improve text flow
\hbadness=10000
\hfuzz=2pt
\vfuzz=2pt

% Configure csquotes for Indonesian language
\MakeOuterQuote{"}

% Setup automatic numbering
\setcounter{chapter}{0}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

% Penomoran otomatis untuk section/subsection
\renewcommand{\thesection}{\arabic{chapter}.\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

% Pengaturan halaman
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\nouppercase{\leftmark}}
\fancyhead[R]{\thepage}
\fancyfoot[C]{Pemrograman Bahasa Tingkat Rendah}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% Untuk halaman pertama chapter
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% Pengaturan judul chapter dengan penomoran otomatis dan judul di tengah
\titleformat{\chapter}[display]
    {\centering\normalfont\huge\bfseries}
    {\centering\chaptertitlename\ \thechapter}
    {20pt}
    {\centering\Huge}
\titlespacing*{\chapter}{0pt}{50pt}{40pt}

% Pengaturan section dan subsection
\titleformat{\section}
    {\normalfont\Large\bfseries}
    {\thesection}
    {1em}
    {}
\titleformat{\subsection}
    {\normalfont\large\bfseries}
    {\thesubsection}
    {1em}
    {}
\titleformat{\subsubsection}
    {\normalfont\normalsize\bfseries}
    {\thesubsubsection}
    {1em}
    {}

% Pengaturan daftar isi
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

\title{Bahasa Pemrograman Tingkat Rendah\\(Assembly Language - Intel 8086)\\\large Program Studi Teknik Informatika\\Fakultas Teknologi Informasi\\Universitas Bale Bandung}
\author{Cecep Suwanda, S.Si., M.Kom.}
\date{\today}

\begin{document}
\frontmatter
\hypersetup{pageanchor=false}
% Custom title page dengan format Indonesia
\begin{titlepage}
  \centering
  \vspace*{2cm}
  
  % Judul buku di bagian atas
  {\huge\bfseries Modul Kuliah\par}
  \vspace{0.2cm}
  {\huge\bfseries Pemrograman Bahasa Tingkat Rendah\par}
  \vspace{0.2cm}
  {\LARGE\bfseries \((Assembly Language - Intel 8086)\)\par}
  
  
  \vfill
  
  % Nama penulis di bagian tengah
  {\large Tim Pengajar \par}
  
  \vfill
  
  % Nama instansi di bagian bawah
  {\large\bfseries Program Studi Teknik Informatika\par}
  \vspace{0.2cm}
  {\large\bfseries Fakultas Teknologi Informasi\par}
  \vspace{0.2cm}
  {\large\bfseries Universitas Bale Bandung\par}
  \vspace{0.2cm}
  {\large \the\year\par}
  
  \vspace{1cm}
\end{titlepage}
\hypersetup{pageanchor=true}
\tableofcontents
\newpage
% Daftar Tabel
\listoftables
\addcontentsline{toc}{chapter}{Daftar Tabel}
\newpage
% Daftar Source Code
\renewcommand{\lstlistlistingname}{Daftar Source Code}
\lstlistoflistings
\addcontentsline{toc}{chapter}{Daftar Source Code}
\newpage
\mainmatter
% Bab-bab (sesuai materi per pertemuan)
\subfile{chapters/ch01}
\subfile{chapters/ch02}
\subfile{chapters/ch03}
\subfile{chapters/ch04}  % Tipe Data dalam Bahasa Assembly (BARU)
\subfile{chapters/ch05}  % Instruksi Dasar (Perpindahan Data dan Aritmatika)
\subfile{chapters/ch06}  % Interrupt dan Sistem BIOS/DOS (BARU)
\subfile{chapters/ch07}  % Logika & bitwise saja (tanpa I/O)
\subfile{chapters/ch08}  % Percabangan & Perulangan (mouse dihapus)
\subfile{chapters/ch09}  % I/O teks dasar (baru)
\subfile{chapters/ch10}  % Input keyboard setelah kontrol alur & I/O teks
\subfile{chapters/ch11}
\subfile{chapters/ch12}
\subfile{chapters/ch13}
%\subfile{chapters/ch14}
%\subfile{chapters/ch15}
%\subfile{chapters/ch16}
%\subfile{chapters/ch17}

\backmatter
\printbibliography[title={Daftar Pustaka}]
\addcontentsline{toc}{chapter}{Daftar Pustaka}
\end{document}
